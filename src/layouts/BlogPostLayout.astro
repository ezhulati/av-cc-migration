---
/**
 * Blog Post Layout
 * Template for individual blog posts
 */

import BaseLayout from './BaseLayout.astro';
import type { CollectionEntry } from 'astro:content';

export interface Props {
  post: CollectionEntry<'posts'>;
}

const { post } = Astro.props;
const { Content } = await post.render();

const {
  title,
  description,
  pubDate,
  updatedDate,
  author,
  category,
  tags,
  featuredImage,
  language,
  alternateURL,
  seo,
} = post.data;

const formattedDate = new Intl.DateTimeFormat(language === 'sq' ? 'sq-AL' : 'en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
}).format(new Date(pubDate));
---

<BaseLayout
  title={seo?.metaTitle || title}
  description={seo?.metaDescription || description}
  canonical={seo?.canonicalURL}
  image={featuredImage}
  type="article"
  publishedTime={pubDate.toISOString()}
  modifiedTime={updatedDate?.toISOString()}
  author={author}
  language={language}
  alternateUrl={alternateURL}
>
  <article class="blog-post">
    <div class="container-custom max-w-7xl">
      <!-- Breadcrumbs -->
      <nav class="breadcrumbs" aria-label="Breadcrumb">
        <ol>
          <li><a href={language === 'sq' ? '/sq/' : '/'}>Home</a></li>
          <li><a href={language === 'sq' ? '/sq/blog/' : '/blog/'}>Blog</a></li>
          {category && (
            <li><a href={`${language === 'sq' ? '/sq' : ''}/blog/category/${category.toLowerCase()}/`}>{category}</a></li>
          )}
          <li aria-current="page">{title}</li>
        </ol>
      </nav>

      <!-- Featured Image (Full Width) -->
      {featuredImage && (
        <div class="featured-image mb-12">
          <img
            src={featuredImage}
            alt={title}
            loading="eager"
          />
        </div>
      )}

      <!-- Two Column Layout: Content + Sidebar -->
      <div class="post-layout">
        <!-- Main Content -->
        <div class="post-main">
          <!-- Post Header -->
          <header class="post-header">
            {category && <span class="post-category">{category}</span>}
            <h1 class="post-title">{title}</h1>

            <div class="post-meta">
              <span class="post-author">By {author}</span>
              <span class="post-date">
                <time datetime={pubDate.toISOString()}>{formattedDate}</time>
              </span>
              {updatedDate && (
                <span class="post-updated">
                  Updated: <time datetime={updatedDate.toISOString()}>
                    {new Intl.DateTimeFormat(language === 'sq' ? 'sq-AL' : 'en-US', {
                      year: 'numeric',
                      month: 'short',
                      day: 'numeric'
                    }).format(new Date(updatedDate))}
                  </time>
                </span>
              )}
            </div>
          </header>

          <!-- Post Content -->
          <div class="post-content">
            <Content />
          </div>

          <!-- Tags -->
          {tags && tags.length > 0 && (
            <div class="post-tags">
              <span class="tags-label">{language === 'sq' ? 'Etiketat:' : 'Tags:'}</span>
              {tags.map((tag) => (
                <a href={`${language === 'sq' ? '/sq' : ''}/blog/tag/${tag.toLowerCase()}/`} class="tag">
                  {tag}
                </a>
              ))}
            </div>
          )}

          <!-- Language Alternate -->
          {alternateURL && (
            <div class="language-alternate">
              <a href={alternateURL}>
                {language === 'sq' ? '🇬🇧 Read in English' : '🇦🇱 Lexoni në Shqip'}
              </a>
            </div>
          )}
        </div>

        <!-- Sidebar -->
        <aside class="post-sidebar">
          <!-- Author Card -->
          <div class="sidebar-card">
            <h3 class="sidebar-title">{language === 'sq' ? 'Rreth Autorit' : 'About the Author'}</h3>
            <p class="text-sm text-muted-foreground mb-4">{author}</p>
            <p class="text-sm">
              {language === 'sq'
                ? 'Kontributor në AlbaniaVisit, duke ndarë njohuri dhe këshilla për udhëtim në Shqipëri.'
                : 'Contributor at AlbaniaVisit, sharing insights and travel tips about Albania.'}
            </p>
          </div>

          <!-- Table of Contents -->
          <div class="sidebar-card">
            <h3 class="sidebar-title">{language === 'sq' ? 'Në këtë artikull' : 'In This Article'}</h3>
            <p class="text-sm text-muted-foreground">
              {language === 'sq'
                ? 'Lexoni më shumë për këtë temë.'
                : 'Explore more about this topic.'}
            </p>
          </div>

          <!-- Related Categories -->
          {category && (
            <div class="sidebar-card">
              <h3 class="sidebar-title">{language === 'sq' ? 'Kategoria' : 'Category'}</h3>
              <a href={`${language === 'sq' ? '/sq' : ''}/blog/category/${category.toLowerCase()}/`}
                 class="inline-flex items-center gap-2 text-sm text-primary hover:text-primary/80 font-semibold">
                {category}
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
              </a>
            </div>
          )}

          <!-- Share -->
          <div class="sidebar-card">
            <h3 class="sidebar-title">{language === 'sq' ? 'Shpërndaje' : 'Share'}</h3>
            <p class="text-sm text-muted-foreground">
              {language === 'sq'
                ? 'Shpërndaje këtë artikull me të tjerët.'
                : 'Share this article with others.'}
            </p>
          </div>
        </aside>
      </div>
    </div>
  </article>
</BaseLayout>

<style>
  .blog-post {
    @apply py-12 md:py-16 lg:py-20;
  }

  /* Breadcrumbs */
  .breadcrumbs {
    @apply mb-8 text-sm;
  }

  .breadcrumbs ol {
    @apply flex flex-wrap gap-2 list-none;
  }

  .breadcrumbs li:not(:last-child)::after {
    content: '›';
    @apply ml-2 text-muted-foreground;
  }

  .breadcrumbs a {
    @apply text-primary no-underline hover:underline;
  }

  .breadcrumbs [aria-current="page"] {
    @apply text-muted-foreground;
  }

  /* Post Layout - Two Columns */
  .post-layout {
    @apply grid lg:grid-cols-[1fr_300px] gap-12;
  }

  .post-main {
    @apply min-w-0;
  }

  /* Post Header */
  .post-header {
    @apply mb-12;
  }

  .post-category {
    @apply inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold transition-colors;
    @apply border-transparent bg-primary text-primary-foreground hover:bg-primary/80 mb-4;
  }

  .post-title {
    @apply text-4xl md:text-5xl font-bold tracking-tight mb-6 text-foreground;
  }

  .post-meta {
    @apply flex flex-wrap gap-4 text-sm text-muted-foreground pb-6 border-b border-border;
  }

  .post-author {
    @apply font-semibold text-foreground flex items-center gap-2;
  }

  .post-author::before {
    content: '✍️';
  }

  .post-date {
    @apply flex items-center gap-2;
  }

  .post-date::before {
    content: '📅';
  }

  .post-updated {
    @apply flex items-center gap-2 text-xs;
  }

  .post-updated::before {
    content: '🔄';
  }

  /* Featured Image */
  .featured-image {
    @apply mb-12 rounded-xl overflow-hidden shadow-xl;
  }

  .featured-image img {
    @apply w-full h-auto max-h-[500px] object-cover;
  }

  /* Post Content */
  .post-content {
    @apply text-lg leading-8 text-foreground;
  }

  .post-content :global(h2) {
    @apply text-3xl font-semibold tracking-tight mt-12 mb-6 text-foreground;
  }

  .post-content :global(h3) {
    @apply text-2xl font-semibold tracking-tight mt-8 mb-4 text-foreground;
  }

  .post-content :global(h4) {
    @apply text-xl font-semibold tracking-tight mt-6 mb-3 text-foreground;
  }

  .post-content :global(p) {
    @apply mb-6;
  }

  .post-content :global(a) {
    @apply text-primary underline hover:no-underline transition-all;
  }

  .post-content :global(img) {
    @apply w-full h-auto rounded-lg shadow-lg my-8;
  }

  .post-content :global(blockquote) {
    @apply border-l-4 border-primary pl-6 my-8 italic text-muted-foreground bg-muted/30 py-4 rounded-r-lg;
  }

  .post-content :global(ul),
  .post-content :global(ol) {
    @apply mb-6 pl-8 space-y-2;
  }

  .post-content :global(ul li) {
    @apply list-disc;
  }

  .post-content :global(ol li) {
    @apply list-decimal;
  }

  .post-content :global(code) {
    @apply bg-muted px-2 py-1 rounded text-sm font-mono;
  }

  .post-content :global(pre) {
    @apply bg-secondary text-secondary-foreground p-6 rounded-lg overflow-x-auto my-8;
  }

  .post-content :global(pre code) {
    @apply bg-transparent p-0 text-secondary-foreground;
  }

  .post-content :global(table) {
    @apply w-full my-8 border-collapse;
  }

  .post-content :global(th) {
    @apply bg-muted px-4 py-3 text-left font-semibold border border-border;
  }

  .post-content :global(td) {
    @apply px-4 py-3 border border-border;
  }

  .post-content :global(hr) {
    @apply my-12 border-border;
  }

  /* Sidebar */
  .post-sidebar {
    @apply space-y-6;
  }

  .sidebar-card {
    @apply rounded-lg border bg-card text-card-foreground shadow-sm p-6;
  }

  .sidebar-title {
    @apply text-lg font-semibold mb-4 text-foreground;
  }

  /* Tags */
  .post-tags {
    @apply mt-12 pt-8 border-t border-border flex flex-wrap gap-3 items-center;
  }

  .tags-label {
    @apply font-semibold text-foreground;
  }

  .tag {
    @apply inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold transition-colors;
    @apply border border-border text-foreground hover:bg-primary hover:text-primary-foreground hover:border-primary;
  }

  /* Language Alternate */
  .language-alternate {
    @apply mt-12 text-center;
  }

  .language-alternate a {
    @apply inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors;
    @apply border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground px-6 py-3;
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .post-layout {
      @apply grid-cols-1;
    }

    .post-sidebar {
      @apply order-first;
    }
  }

  @media (max-width: 768px) {
    .post-title {
      @apply text-3xl;
    }

    .post-content {
      @apply text-base;
    }

    .post-content :global(h2) {
      @apply text-2xl;
    }

    .post-content :global(h3) {
      @apply text-xl;
    }
  }
</style>
